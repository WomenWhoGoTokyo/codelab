
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Go ã®ä¸¦è¡Œå‡¦ç†ã‚’ä½“é¨“ã—ã¦ã¿ã‚ˆã†</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="tutorial-concurrency-go"
                  title="Go ã®ä¸¦è¡Œå‡¦ç†ã‚’ä½“é¨“ã—ã¦ã¿ã‚ˆã†"
                  environment="web"
                  feedback-link="https://github.com/WomenWhoGoTokyo/codelab/issues">
    
      <google-codelab-step label="ã¯ã˜ã‚ã«" duration="0">
        <p>ã“ã®ã‚³ãƒ¼ãƒ‰ãƒ©ãƒœã§ã¯ã€ç”»åƒã®ãƒªã‚µã‚¤ã‚ºå‡¦ç†ã‚’é¡Œæã«ã€é€šå¸¸ã®å‡¦ç†ã¨ä¸¦è¡Œå‡¦ç†ã®2ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ›¸ãã“ã¨ã§ã€Go ã®ä¸¦è¡Œå‡¦ç†ã‚’ä½“é¨“ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
<p>ä¸‹è¨˜ã®æµã‚Œã§é–‹ç™ºã‚’è¡Œã„ã¾ã™ã€‚</p>
<ol type="1" start="1">
<li>Go ã§æ›¸ã‹ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ãƒ»ç¢ºèªã™ã‚‹ã€‚</li>
<li>ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ã€‚</li>
<li>ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã€‚</li>
<li>ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ Go ã®ä¸¦è¡Œå‡¦ç†ã«å¤‰æ›´ã™ã‚‹ã€‚</li>
<li>Go ã®ä¸¦è¡Œå‡¦ç†ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ã€‚</li>
<li>ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œã—ã¦ã€3. ã¨æ¯”è¼ƒã™ã‚‹ã€‚</li>
</ol>
<h2 is-upgraded>Go ã®é–‹ç™ºç’°å¢ƒã¯å¿…è¦ã§ã—ã‚‡ã†ã‹ï¼Ÿ</h2>
<p>ãŠä½¿ã„ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ä¸Šã§ Go ã®é–‹ç™ºç’°å¢ƒã‚’ç”¨æ„ã—ã¦ã„ãªã„æ–¹ã¯ã€Google Cloud Shell ã¨ã„ã†ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®é–‹ç™ºç’°å¢ƒã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ã™ãã« Go ã®é–‹ç™ºã‚’ã¯ã˜ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
<p>Google Cloud Shell ã®è©³ã—ã„èª¬æ˜ã¨ä½¿ã„æ–¹ã¯ <a href="https://womenwhogotokyo.github.io/codelab/google-cloud-shell-go?index=codelab" target="_blank">Google Cloud Shell ã§ Go ã®é–‹ç™ºã‚’ã¯ã˜ã‚ã‚ˆã†</a>  ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹" duration="0">
        <p>GitHub ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ãƒ©ãƒœã§åˆ©ç”¨ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¾ã—ã‚‡ã†ã€‚</p>
<pre>$ git clone https://github.com/WomenWhoGoTokyo/codelab.git</pre>
<p>Google Cloud Shell ã‚’ã”åˆ©ç”¨ã®æ–¹ã¯ã€<a href="https://github.com/WomenWhoGoTokyo/codelab/tree/master/image-slender" target="_blank">https://github.com/WomenWhoGoTokyo/codelab/tree/master/image-slender</a> ã®ã€ŒOPEN IN GOOGLE CLOUD SHELLã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã—ã¦ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚</p>
<p class="image-container"><img style="width: 610.00px" src="img/df5b1eed0035be23.png"></p>
<p><code>ã‚³ãƒ¼ãƒ‰ãŒ</code>å–å¾—ã§ããŸã‚‰ã€codelab/image-slender ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</p>
<pre>$ cd codelab/image-slender
$ ls
go.mod  go.sum  images  images.yaml  main.go  main_test.go  README.md  slender</pre>
<p>ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p>
<pre>â”œâ”€â”€ README.md
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ images
â”‚   â”œâ”€â”€ fukuoka-bear.png
â”‚   â”œâ”€â”€ nagoya-bear.png
â”‚   â”œâ”€â”€ osaka-bear.png
â”‚   â”œâ”€â”€ sapporo-bear.png
â”‚   â””â”€â”€ tokyo-bear.png
â”œâ”€â”€ images.yaml
â”œâ”€â”€ main.go
â””â”€â”€ slender
    â””â”€â”€ slender.go
</pre>
<aside class="special"><h3 is-upgraded><strong>ã‚³ãƒãƒ³ãƒ‰ã®èª¬æ˜</strong></h3>
<p><code>cd</code><strong> </strong>: ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç§»å‹•ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚<code>cd codelab/image-slender</code> ã¯ã€<code>codelab</code> ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã•ã‚‰ã«ä¸‹ã® <code>image-slender</code> ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¾ã™ã€‚</p>
<p><code>ls</code>: ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚ã“ã“ã§ã¯ <code>image-slender</code> ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã£ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹" duration="0">
        <p>å–å¾—ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
<p><code>codelab/image-slender</code> ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>
<pre>$ go build -v -o image-slender</pre>
<p><code>go build</code> ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚</p>
<p class="image-container"><img style="width: 610.00px" src="img/202cee11e53c739b.png"></p>
<p>ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
<pre>$ ./image-slender</pre>
<p>ã—ã°ã‚‰ãã™ã‚‹ã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã« ã€ŒThe images are slender.ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
<p class="image-container"><img style="width: 610.00px" src="img/d134b3b1cac86c5f.png"></p>
<p><code>images</code> ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« <code>*-bear-slender.png</code> ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ–°ã—ãè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚</p>
<p class="image-container"><img style="width: 610.00px" src="img/994a0977bdfe3a9b.png"></p>
<p>ãŸã‚ã—ã« <code>tokyo-bear.png</code> ã¨ <code>tokyo-bear-slender.png</code> ã‚’è¦‹æ¯”ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
<p class="image-container"><img style="width: 624.00px" src="img/2468dbddc254ebd7.png"></p>
<p>ç”»åƒã®ã‚¯ãƒãŒã‚¹ãƒªãƒ ã«ãªã‚Šã¾ã—ãŸã€‚</p>
<p>ã“ã®ã‚ˆã†ã«ã€ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯ã€<code>images</code> ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç”»åƒã‚’ç—©ã›ã•ã› (ãƒªã‚µã‚¤ã‚ºã—) ã€åˆ¥åã§ä¿å­˜ã™ã‚‹å‡¦ç†ã‚’ Go ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§æ›¸ã„ãŸã‚‚ã®ã§ã™ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹" duration="0">
        <p><code>image-slender ãƒ‡ã‚£ãƒ</code>¬ã‚¯ãƒˆãƒªã®ä¸‹ã« main_test.go ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ä¸‹è¨˜ã®ã‚ˆã†ã« <code>Go</code> ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ãã¾ã—ã‚‡ã†ã€‚</p>
<p><code>codelab/image-slender/main_test.go</code></p>
<pre><code>package main

import &#34;testing&#34;

func BenchmarkExecute(b *testing.B) {
        b.ResetTimer()
        for i := 0; i &lt; b.N; i++ {
                execute()
        }
}</code></pre>
<p>ã“ã‚Œã¯ã€<code>main.go ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ execute ã¨ã„ã†é–¢æ•°ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®å‡¦ç†ã§ã™ã€‚å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</code></p>
<pre>$ go test -count 10 -bench BenchmarkExecute</pre>
<p>ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã®å®Ÿè¡ŒçµæœãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã€‚</p>
<pre>goos: darwin
goarch: amd64
pkg: github.com/mi-bear/image-slender
BenchmarkExecute-8                  1        15800638167 ns/op
BenchmarkExecute-8                  1        15737073630 ns/op
BenchmarkExecute-8                  1        15742299275 ns/op
BenchmarkExecute-8                  1        15739635788 ns/op
BenchmarkExecute-8                  1        15752764686 ns/op
BenchmarkExecute-8                  1        15728355016 ns/op
BenchmarkExecute-8                  1        15775978024 ns/op
BenchmarkExecute-8                  1        15731555275 ns/op
BenchmarkExecute-8                  1        15725556579 ns/op
BenchmarkExecute-8                  1        15711972716 ns/op
PASS
ok          github.com/mi-bear/image-slender        157.465s</pre>


      </google-codelab-step>
    
      <google-codelab-step label="ä¸¦è¡Œå‡¦ç†ã‚’æ›¸ã„ã¦ã¿ã‚‹" duration="0">
        <p><code>main.go</code> ã‚’å¤‰æ›´ã—ã¦ã€ç”»åƒã®ãƒªã‚µã‚¤ã‚ºã‚’ä¸¦è¡Œå‡¦ç†ã§å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
<p>ã¾ãšã¯ã€<code>main.go</code> ã® <code>execute()</code> ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
<p><code>codelab/image-slender/main.go</code></p>
<pre><code>package main

import (
        &#34;fmt&#34;
        &#34;os&#34;

        &#34;github.com/jinzhu/configor&#34;
        &#34;github.com/mi-bear/image-slender/slender&#34;
)
.
.
.
func execute() error {
        configor.Load(&amp;Config, &#34;images.yaml&#34;)
        images := Config.Images

        for _, image := range images {
                image := image
                slenderImage := slender.SlenderImage(image)
                if err := slenderImage.Make(); err != nil {
                        return err
                }
        }
        return nil
}</code></pre>
<p><code>images.yaml</code> ã«è¨­å®šã—ãŸç”»åƒã‚’ã€1ä»¶ãšã¤ãƒªã‚µã‚¤ã‚ºå‡¦ç†ã—ã¦ã„ã¾ã™ã€‚</p>
<p>ç”»åƒå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€<code>execute()</code> ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ <code>main</code> é–¢æ•°ã«ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã—ã¦ã„ã¾ã™ã€‚</p>
<p>å‡¦ç†ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ç®‡æ‰€ã‚’ <code>golang.org/x/sync/errgroup</code> ã‚’åˆ©ç”¨ã—ã¦ã€å¹³è¡Œå‡¦ç†ã«å¤‰æ›´ã—ã¾ã—ã‚‡ã†ã€‚</p>
<p><code>codelab/image-slender/main.go</code></p>
<pre><code>package main

import (
        &#34;fmt&#34;
        &#34;os&#34;

        &#34;github.com/jinzhu/configor&#34;
        &#34;github.com/mi-bear/image-slender/slender&#34;
        &#34;golang.org/x/sync/errgroup&#34;
)
.
.
.
func execute() error {
        configor.Load(&amp;Config, &#34;images.yaml&#34;)
        images := Config.Images

        eg := &amp;errgroup.Group{}

        for _, image := range images {
                image := image
                eg.Go(func() error {
                        slenderImage := slender.SlenderImage(image)
                        return slenderImage.Make()
                })
        }

        if err := eg.Wait(); err != nil {
                return err
        }
        return nil
}</code></pre>
<p><code>errgroup</code> ã¯ã€<code>errgroup.Go</code> ã®å‡¦ç†ã‚’ã™ã¹ã¦å®Ÿè¡Œã—çµ‚ã‚ã‚‹ã¾ã§ã€<code>errgroup.Wait</code> ãŒå‘¼ã°ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãŸã€<code>errgroup.Go</code> ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‚‰ã€ãã®ã†ã¡ä¸€ç•ªæœ€åˆã®ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´ã—ã¾ã™ã€‚ </p>
<pre>$ go build -v -o image-slender
$ ./image-slender</pre>
<p> æ›´æ–°ã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä¿å­˜ã—ãŸã‚‰ã€å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>


      </google-codelab-step>
    
      <google-codelab-step label="ä¸¦è¡Œå‡¦ç†ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹" duration="0">
        <p>ä¸¦è¡Œå‡¦ç†ã«æ›¸ãç›´ã—ãŸ Go ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
<pre>$ go test -count 10 -bench BenchmarkExecute</pre>
<p>ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã®å®Ÿè¡ŒçµæœãŒå‡ºåŠ›ã•ã‚Œã¾ã—ãŸã€‚</p>
<pre>goos: darwin
goarch: amd64
pkg: github.com/mi-bear/image-slender
BenchmarkExecute-8                  1        3426717180 ns/op
BenchmarkExecute-8                  1        3370627914 ns/op
BenchmarkExecute-8                  1        3379053786 ns/op
BenchmarkExecute-8                  1        3349740755 ns/op
BenchmarkExecute-8                  1        3383601348 ns/op
BenchmarkExecute-8                  1        3399993295 ns/op
BenchmarkExecute-8                  1        3425098299 ns/op
BenchmarkExecute-8                  1        3378263273 ns/op
BenchmarkExecute-8                  1        3413634149 ns/op
BenchmarkExecute-8                  1        3375049615 ns/op
PASS
ok          github.com/mi-bear/image-slender        33.929s</pre>
<p>æ”¹å–„å‰å¾Œã®å¹³å‡å®Ÿè¡Œæ™‚é–“ã‚’æ¯”ã¹ã¦ã¿ã‚‹ã¨åŠ¹æœãŒã‚ã‹ã‚Šã¾ã™ã€‚</p>
<p>å‰:</p>
<pre>157.465s</pre>
<p>å¾Œ:</p>
<pre>33.929s</pre>


      </google-codelab-step>
    
      <google-codelab-step label="ã•ã„ã”ã«" duration="0">
        <p>ã“ã®ã‚³ãƒ¼ãƒ‰ãƒ©ãƒœã§ã¯ã€ç”»åƒã®ãƒªã‚µã‚¤ã‚ºå‡¦ç†ã‚’é¡Œæã«ã€é€šå¸¸ã®å‡¦ç†ã¨ä¸¦è¡Œå‡¦ç†ã®2ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ›¸ãã“ã¨ã§ã€Go ã®ä¸¦è¡Œå‡¦ç†ã‚’ä½“é¨“ã—ã¾ã—ãŸã€‚</p>
<p>Go ã®ä¸¦è¡Œå‡¦ç†ã¯ã€çµæœãŒå¾—ã‚‰ã‚Œã‚„ã™ã„ã®ã§ã€ä»Šå¾Œã‚‚æ¥½ã—ãä¸¦è¡Œãƒ»åŠ¹ç‡åŒ–ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>

</body>
</html>
